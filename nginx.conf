server {
    listen 80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html;

    # Serve static files
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Proxy for Image Upload
    location /api/upload {
        proxy_pass https://img.scdn.io/api/v1.php;
        proxy_ssl_server_name on;
        proxy_set_header Host img.scdn.io;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Proxy for AI Generation
    location /api/generate {
        rewrite ^/api/generate /v1/draw/nano-banana break;
        proxy_pass https://grsai.dakka.com.cn;
        
        proxy_ssl_server_name on;
        proxy_set_header Host grsai.dakka.com.cn;

        # Disable buffering for SSE / Streaming response
        proxy_buffering off;
        proxy_cache off;
        proxy_read_timeout 300s;
        proxy_send_timeout 300s;
    }

    # Proxy for AMap Search (Gaode)
    location /amap-search {
        rewrite ^/amap-search(.*)$ /v3/assistant/inputtips$1 break;
        proxy_pass https://restapi.amap.com;
        
        proxy_ssl_server_name on;
        proxy_set_header Host restapi.amap.com;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Proxy for Photon Search (Global)
    location /photon {
        rewrite ^/photon(.*)$ /api$1 break;
        proxy_pass https://photon.komoot.io;
        
        proxy_ssl_server_name on;
        proxy_set_header Host photon.komoot.io;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
